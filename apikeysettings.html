<!DOCTYPE html>
<html>
  
  <head>
    <base target="_top">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
    crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous">
    </script>
    <style>
      .branding-below { bottom: 56px; top: 0; } .branding-text { left: 7px;
      position: relative; top: 3px; } .logo { vertical-align: middle; } .width-100
      { width: 100%; }
    </style>
    <title>
    </title>
  </head>
  
  <body>
    <div class="branding-below">
      <form>
        <div class="alert alert-success" style="display: none" role="alert" id="saved-alert">
          Your API Key is now saved!
        </div>
        <div class="alert alert-success" style="display: none" role="alert" id="deleted-alert">
          Your API Key is now deleted!
        </div>
        <div>
          <label for="api-key-form">
            <b>
              OpenAI API Key
            </b>
          </label>
          <br />
          <textarea class="width-100" id="api-key-form" rows="2"></textarea>
        </div>
        <div class="btn-group" role="group" aria-label="Basic example">
          <button type="button" id="save-key" class="btn btn-primary my-1">
            Save Key
          </button>
          <button type="button" id="clear-key" class="btn btn-primary my-1">
            Clear Key
          </button>
        </div>
      </form>
    </div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
    </script>
    <script>
      /**
   * On document load, assign click handlers to each button and try to load the
   * user's origin and destination language preferences if previously set.
   */
      $(function() {
        $('#save-key').click(saveAPIKey);
        $('#clear-key').click(clearAPIKey);
        google.script.run.withSuccessHandler(function(apiKey) {
          if (apiKey.openAIAPIKey) {
            const length = apiKey.openAIAPIKey.length;
            var output = "";
            for (var i = 0; i < length; i++) {
              output += "*";
            }
            $('#api-key-form').val(output);
            $('#save-key').attr('disabled', 'disabled');
            $('#api-key-form').attr('disabled', 'disabled');
          }
        }).getAPIKey();
      });

      /** 
       * Saves entered API key
      */
      function saveAPIKey() {
        const key = $('#api-key-form').val();
        $('#save-key').attr('disabled', 'disabled');
        google.script.run.withSuccessHandler(function() {
          $('#api-key-form').attr('disabled', 'disabled');
          $('#saved-alert').show();
          setTimeout(function() {
            $("#saved-alert").hide();
          },
          5000);
        }).setAPIKey(key);
      }

      /** 
       * Clears saved API key
      */
      function clearAPIKey() {
        $('#clear-key').attr('disabled', 'disabled');
        google.script.run.withSuccessHandler(function(apiKey) {
          $('#api-key-form').val("");
          $("#clear-key").removeAttr("disabled");
          $('#save-key').removeAttr('disabled');
          $('#api-key-form').removeAttr('disabled');
          $('#deleted-alert').show();
          setTimeout(function() {
            $("#deleted-alert").hide();
          },
          5000);
        }).removeAPIKey();
      }
    </script>
  </body>

</html>
